"use strict";(self.webpackChunkdev_doc=self.webpackChunkdev_doc||[]).push([[527],{7672:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>a});var i=n(4897);const l={},r=i.createContext(l);function t(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:s},e.children)}},8697:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"evenements/export-json-migration","title":"Migration de l\'export JSON vers l\'API","description":"L\'export JSON, en place depuis 2015 et en d\xe9pr\xe9cation depuis 2022, arrive en fin de vie en fin 2025. Pr\xe9voyez une mise \xe0 jour de vos scripts & applications qui s\'en servent pour passer \xe0 l\'API v2, en place depuis 2018. Ce guide \xe0 pour objectif de fournir les \xe9l\xe9ments utiles pour vous assurer une migration dans les meilleures conditions.","source":"@site/docs/evenements/export-json-migration.md","sourceDirName":"evenements","slug":"/evenements/export-json-migration","permalink":"/evenements/export-json-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/OpenAgenda/dev-doc/docs/evenements/export-json-migration.md","tags":[],"version":"current","frontMatter":{}}');var l=n(4373),r=n(7672);const t={},a="Migration de l'export JSON vers l'API",d={},o=[{value:"Quelques d\xe9tails:",id:"quelques-d\xe9tails",level:2},{value:"Les filtres",id:"les-filtres",level:2},{value:"La navigation",id:"la-navigation",level:2},{value:"Les contenus",id:"les-contenus",level:2},{value:"Champ image",id:"champ-image",level:3},{value:"Liste des plages horaires",id:"liste-des-plages-horaires",level:3},{value:"Les tags et les champs custom",id:"les-tags-et-les-champs-custom",level:3},{value:"La description longue",id:"la-description-longue",level:3},{value:"Les lieux",id:"les-lieux",level:3},{value:"Am\xe9nagements \xe0 l&#39;accessibilit\xe9",id:"am\xe9nagements-\xe0-laccessibilit\xe9",level:3},{value:"Autres",id:"autres",level:3}];function c(e){const s={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.header,{children:(0,l.jsx)(s.h1,{id:"migration-de-lexport-json-vers-lapi",children:"Migration de l'export JSON vers l'API"})}),"\n",(0,l.jsx)(s.p,{children:"L'export JSON, en place depuis 2015 et en d\xe9pr\xe9cation depuis 2022, arrive en fin de vie en fin 2025. Pr\xe9voyez une mise \xe0 jour de vos scripts & applications qui s'en servent pour passer \xe0 l'API v2, en place depuis 2018. Ce guide \xe0 pour objectif de fournir les \xe9l\xe9ments utiles pour vous assurer une migration dans les meilleures conditions."}),"\n",(0,l.jsx)(s.h2,{id:"quelques-d\xe9tails",children:"Quelques d\xe9tails:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"L'export JSON"}),' : Nous appelons ici "export JSON" le lien qui \xe9tait donn\xe9 sur le menu d\'export des pages agenda sur ',(0,l.jsx)(s.a,{href:"https://openagenda.com",children:"https://openagenda.com"})," pour lire le contenu d'un agenda au format JSON. Il prend la forme suivante : ",(0,l.jsx)(s.code,{children:"https://openagenda.com/agendas/{agendaUid}/events.json"})," et est document\xe9 ici : ",(0,l.jsx)(s.a,{href:"https://developers.openagenda.com/export-json-dun-agenda/",children:"https://developers.openagenda.com/export-json-dun-agenda/"})]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Lecture API v2"})," : Le point de lecture des \xe9v\xe9nements d'un agenda via l'API v2 document\xe9 sur cette page ",(0,l.jsx)(s.a,{href:"https://developers.openagenda.com/10-lecture/",children:"https://developers.openagenda.com/10-lecture/"})," et prend la forme ",(0,l.jsx)(s.code,{children:"https://api.openagenda.com/v2/agendas/{agendaUid}/events"})]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"Toute migration doit prendre en compte les trois aspects d\xe9taill\xe9s dans les sections suivantes:"}),"\n",(0,l.jsxs)(s.ol,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Les filtres"})," : la syntaxe \xe9volue, en particulier pour les filtres temporels et les tags/categories qui sont remplac\xe9s par des champs additionnels,"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"La navigation"})," : les cl\xe9s \xe0 utiliser changent,"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Les contenus"})," : tags & categories disparaissent et sont remplac\xe9s par des champs additionnels, d'autres ajustements sont d\xe9taill\xe9s ci-dessous."]}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"les-filtres",children:"Les filtres"}),"\n",(0,l.jsxs)(s.p,{children:["L'export JSON rassemble tous les filtres dans une cl\xe9 de requ\xeate ",(0,l.jsx)(s.em,{children:"oaq"}),". Les filtres de l'API de lecture v2 se mettent directement au premier niveau."]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Important"})," : par d\xe9faut, l'export JSON ne pr\xe9sente que les \xe9v\xe9nements \xe0 venir, tri\xe9s du plus proche au plus lointain dans le temps. Sur l'API v2, tous les \xe9v\xe9nements publi\xe9s sont pr\xe9sent\xe9s, en premier ceux \xe0 venir du plus proche du temps pr\xe9sent au plus lointain suivi des pass\xe9s du plus proche du pr\xe9sent au plus lointain. Pour limiter la s\xe9lection sur l'API v2 aux \xe9v\xe9nements pr\xe9sents et \xe0 venir, le filtre suivant doit \xeatre utilis\xe9 :"]}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"?relative[]=ongoing&relative[]=upcoming"})}),"\n",(0,l.jsx)(s.p,{children:"Par exemple, une requ\xeate d\xe9limitant les \xe9v\xe9nements qui se d\xe9roulent sur une journ\xe9e pr\xe9cise sont cibl\xe9es de la mani\xe8re suivante sur l'export JSON:"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"https://openagenda.com/agendas/{agendaUid}/events.json?oaq[from]=2021-02-07"})}),"\n",(0,l.jsx)(s.p,{children:"... et de la mani\xe8re suivante sur l'API v2:"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"https://api.openagenda.com/v2/agendas/{agendaUid}/events?timings[gte]=2022-02-01T23:00:00.000Z&timings[lte]=2022-02-02T22:59:59.999Z"})}),"\n",(0,l.jsxs)(s.p,{children:["Il y a des petites variations pour chaque filtres, document\xe9es dans les pages donn\xe9es en t\xeate d'article. Le principal changement concerne le remplacement de la notion de ",(0,l.jsx)(s.em,{children:"tag"})," sur openagenda.com par la notion de ",(0,l.jsx)(s.em,{children:"champ additionnels"})," : sur l'export JSON, la cl\xe9 oaq[",(0,l.jsx)(s.em,{children:"tags]"})," est utilis\xe9e pour filtrer sur une valeur provenant d'un champ \xe0 choix sur le formulaire \xe9v\xe9nement de l'agenda correspondant. Sur l'API v2, la cl\xe9 \xe0 utiliser est celle du champ m\xeame, donn\xe9e dans la configuration de l'agenda (",(0,l.jsx)(s.a,{href:"/agendas/lecture",children:"document\xe9 ici"}),")."]}),"\n",(0,l.jsx)(s.p,{children:"Les valeurs \xe0 pr\xe9ciser ne sont plus les codes de tags mais les identifiants. Ainsi, le filtre suivant sur l'export JSON :"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"https://openagenda.com/agendas/{agendaUid}/events.json?oaq[tags][]=atelier&key=VOTRECLE"})}),"\n",(0,l.jsx)(s.p,{children:"... devient sur l'API v2 :"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"https://api.openagenda.com/v2/agendas/{agendaUid}/events?categories-metropolitaines[]=3&key=VOTRECLE"})}),"\n",(0,l.jsx)(s.h2,{id:"la-navigation",children:"La navigation"}),"\n",(0,l.jsx)(s.p,{children:"Dans les deux cas, les r\xe9sultats sont pagin\xe9s. Dans le cas de l'export JSON, seule une navigation qui utilise les cl\xe9s ?offset et &limit est possible."}),"\n",(0,l.jsx)(s.p,{children:"L'\xe9quivalence sur l'API v2 est retrouv\xe9e en utilisant les cl\xe9s ?from et &size"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"Important"}),": pour la lecture de programmations enti\xe8res, l'API v2 propose une cl\xe9 ",(0,l.jsx)(s.em,{children:"after"})," \xe0 utiliser dans le cadre d'une boucle de lecture. Il faut \xe9viter de boucler sur un grand nombre d'it\xe9rations avec la cl\xe9 ",(0,l.jsx)(s.em,{children:"from"}),". Plus la valeur ",(0,l.jsx)(s.em,{children:"from"})," sera importante, moins la requ\xeate sera performante. Les trop grandes valeurs de ",(0,l.jsx)(s.em,{children:"from"})," peuvent \xeatre bloqu\xe9es."]}),"\n",(0,l.jsx)(s.h2,{id:"les-contenus",children:"Les contenus"}),"\n",(0,l.jsx)(s.p,{children:"Par d\xe9faut, seuls certains champs sont pr\xe9sent\xe9s sur l'API. Pour avoir le d\xe9tail des horaires ainsi que les champs additionnels, il faudra rajouter un ?detailed=1 \xe0 la requ\xeate."}),"\n",(0,l.jsx)(s.p,{children:"Les \xe9volutions sur les champs suivants sont \xe0 prendre en compte."}),"\n",(0,l.jsx)(s.h3,{id:"champ-image",children:"Champ image"}),"\n",(0,l.jsxs)(s.p,{children:["Sur l'export JSON, les images \xe9taient pr\xe9sent\xe9es en premier niveau derri\xe8re les cl\xe9s ",(0,l.jsx)(s.em,{children:"image, thumbnail"})," et ",(0,l.jsx)(s.em,{children:"originalImage"})]}),"\n",(0,l.jsxs)(s.p,{children:["D\xe9sormais, les donn\xe9es image sont pr\xe9sent\xe9es sous une unique cl\xe9 image, tel que document\xe9 ici: ",(0,l.jsx)(s.a,{href:"https://developers.openagenda.com/00-structure-evenement/#image",children:"https://developers.openagenda.com/00-structure-evenement/#image"})]}),"\n",(0,l.jsx)(s.h3,{id:"liste-des-plages-horaires",children:"Liste des plages horaires"}),"\n",(0,l.jsxs)(s.p,{children:["Sur l'export, une liste d'items avec cl\xe9s ",(0,l.jsx)(s.code,{children:"{ start, end }"})," est donn\xe9e derri\xe8re la cl\xe9 ",(0,l.jsx)(s.code,{children:"timings"}),", dont les valeurs sont cal\xe9es sur le fuseau UTC."]}),"\n",(0,l.jsxs)(s.p,{children:["Sur l'API, la cl\xe9 ",(0,l.jsx)(s.em,{children:"start"})," est remplac\xe9e par une cl\xe9 ",(0,l.jsx)(s.em,{children:"begin."})," Les horaires sont donn\xe9es dans le fuseau local."]}),"\n",(0,l.jsxs)(s.p,{children:["Par exemple, une donn\xe9e ",(0,l.jsx)(s.em,{children:"start"})," d'un premier item de la liste ",(0,l.jsx)(s.em,{children:"timings"})," de l'export JSON avec pour valeur ",(0,l.jsx)(s.em,{children:"2022-02-07T09:00:00.000Z"})," sera pr\xe9sent\xe9e sous la cl\xe9 ",(0,l.jsx)(s.em,{children:"begin"})," dans l'API avec la valeur ",(0,l.jsx)(s.em,{children:"2022-02-07T10:00:00+0100"})]}),"\n",(0,l.jsx)(s.h3,{id:"les-tags-et-les-champs-custom",children:"Les tags et les champs custom"}),"\n",(0,l.jsxs)(s.p,{children:["Les tags & champs custom de l'export JSON sont pr\xe9sent\xe9s sous 3 cl\xe9s: ",(0,l.jsx)(s.em,{children:"tags"})," et ",(0,l.jsx)(s.em,{children:"tagGroups"})," pour les tags, ",(0,l.jsx)(s.em,{children:"custom"})," pour les donn\xe9es particuli\xe8res aux agendas."]}),"\n",(0,l.jsxs)(s.p,{children:["Sur OpenAgenda, les tags et champs custom sont d\xe9sormais int\xe9gr\xe9s dans une notion de ",(0,l.jsx)(s.em,{children:"champs additionnels."})," Les codes ",(0,l.jsx)(s.em,{children:"tags, tagGroups"})," ou ",(0,l.jsx)(s.em,{children:"custom"})," de l'export JSON ne sont pas repris sur l'API v2. Les valeurs de chaque champ additionnel sont pr\xe9sent\xe9es sous des cl\xe9s propres \xe0 chaque champ. Ces cl\xe9s, ainsi que les identifiants des s\xe9lections propos\xe9es par les champs additionnels \xe0 choix sont list\xe9es dans ",(0,l.jsx)(s.a,{href:"/agendas/lecture",children:"la configuration de l'agenda"}),"."]}),"\n",(0,l.jsx)(s.h3,{id:"la-description-longue",children:"La description longue"}),"\n",(0,l.jsxs)(s.p,{children:["L'export JSON d\xe9cline la description longue sous deux cl\xe9s : ",(0,l.jsx)(s.em,{children:"longDescription"})," et ",(0,l.jsx)(s.em,{children:"html."}),' Une option (include_embedded) permet de remplacer les liens pointant vers des contenus multim\xe9dias par leurs \xe9quivalents "embeds".']}),"\n",(0,l.jsxs)(s.p,{children:["L'API ne pr\xe9sente plus que le champ ",(0,l.jsx)(s.em,{children:"longDescription"}),", son format peut \xeatre contr\xf4l\xe9 par le param\xe8tre ",(0,l.jsx)(s.em,{children:"longDescriptionFormat"})," tel que d\xe9taill\xe9 ici : ",(0,l.jsx)(s.a,{href:"https://developers.openagenda.com/10-lecture/",children:"https://developers.openagenda.com/10-lecture/"})]}),"\n",(0,l.jsx)(s.h3,{id:"les-lieux",children:"Les lieux"}),"\n",(0,l.jsxs)(s.p,{children:["Toutes les donn\xe9es relatives au lieu o\xf9 se d\xe9roule l'\xe9v\xe9nement se trouvent d\xe9sormais sous la cl\xe9 ",(0,l.jsx)(s.em,{children:"location."})]}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"A noter"}),": il est d\xe9sormais possible de d\xe9finir des \xe9v\xe9nements en ligne sur OpenAgenda. Dans ce cas, la saisie du lieu devient optionnelle."]}),"\n",(0,l.jsx)(s.h3,{id:"am\xe9nagements-\xe0-laccessibilit\xe9",children:"Am\xe9nagements \xe0 l'accessibilit\xe9"}),"\n",(0,l.jsxs)(s.p,{children:["La structure de la donn\xe9e sous la cl\xe9 ",(0,l.jsx)(s.em,{children:"accessibility"})," liste d\xe9sormais tous les types possibles sous la forme d'un objet. Exemple :"]}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{children:'{\n  ...\n  "accessibility":{"ii":false,"hi":false,"vi":false,"pi":false,"mi":true}\n  ...\n}\n'})}),"\n",(0,l.jsx)(s.h3,{id:"autres",children:"Autres"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.em,{children:"origin"})," se nomme d\xe9sormais ",(0,l.jsx)(s.em,{children:"originAgenda."})," Cette donn\xe9e d\xe9crit l'agenda dans lequel l'\xe9v\xe9nement a \xe9t\xe9 saisi. Vient s'ajouter ",(0,l.jsx)(s.em,{children:"sourceAgenda"}),", qui fait r\xe9f\xe9rence \xe0 l'agenda d'o\xf9 est remont\xe9 l'\xe9v\xe9nement, en cas d'un ajout automatique depuis l'une des sources de l'agenda."]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);